app-id: org.particleviewer.ParticleViewer
runtime: org.freedesktop.Platform
runtime-version: '24.08'
sdk: org.freedesktop.Sdk
command: Viewer

finish-args:
  # Graphics access
  - --device=dri
  - --socket=x11
  - --socket=wayland
  - --share=ipc
  
  # File system access for loading particle files
  - --filesystem=home
  - --filesystem=xdg-documents
  - --filesystem=xdg-download
  
  # File picker portal access
  - --talk-name=org.freedesktop.portal.FileChooser

modules:
  # GLM (header-only library)
  - name: glm
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DGLM_TEST_ENABLE=OFF
    sources:
      - type: archive
        url: https://github.com/g-truc/glm/archive/refs/tags/0.9.9.8.tar.gz
        sha256: 7d508ab72cb5d43227a3711420f06ff99b0a0cb63ee2f93631b162bfe1fe9592

  # GLFW
  - name: glfw
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DGLFW_BUILD_EXAMPLES=OFF
      - -DGLFW_BUILD_TESTS=OFF
      - -DGLFW_BUILD_DOCS=OFF
    sources:
      - type: archive
        url: https://github.com/glfw/glfw/archive/refs/tags/3.3.9.tar.gz
        sha256: a7e7faef424fcb5f83d8faecf9d697a338da7f7a906fc1afbc0e1879ef31bd53

  # Particle Viewer application
  - name: particle-viewer
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_TESTS=OFF
    sources:
      - type: dir
        path: ..
    post-install:
      - install -Dm644 flatpak/org.particleviewer.ParticleViewer.desktop /app/share/applications/org.particleviewer.ParticleViewer.desktop
      - install -Dm644 flatpak/org.particleviewer.ParticleViewer.metainfo.xml /app/share/metainfo/org.particleviewer.ParticleViewer.metainfo.xml
